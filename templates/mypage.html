<!DOCTYPE html>
<html lang="en">
<!-- 보낸친구,메세지 보기 기능 만들기,쿠폰 front에서 보여주고 인스타 id 받는 기능 만들기 -->
<!-- 인스타 중복 안 하도록 입력창 자동화 만들기 -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5553321377490901"
        crossorigin="anonymous"></script>
    <title>Document</title>
    <style>
        body {
            background-color: rgba(244, 223, 30, 0.56);

            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .christmas {
            position: absolute;
        }

        .tree {
            position: relative;
            background-color: #685044;
            width: 30px;
            height: 80px;
            top: 100px;
            transform-style: preserve-3d;
        }

        .tree:before {
            content: "";
            position: relative;
            width: 0;
            height: 0;
            border-left: 90px solid transparent;
            border-right: 90px solid transparent;
            border-bottom: 270px solid #127475;
            border-radius: 30px;
            top: -250px;
            left: -75px;
        }



        .chain {
            width: 85px;
            height: 85px;
            border: solid 3px #333;
            border-radius: 50%;
            top: -185px;
            left: -35px;
            position: absolute;
            transform: rotate3d(8, 0.1, -5, 75deg);
            box-sizing: border-box;
            backface-visibility: visible !important;
            z-index: 5;
        }

        .chain2 {
            width: 145px;
            height: 135px;
            border: solid 3px #333;
            border-radius: 50%;
            top: -115px;
            left: -65px;
            position: absolute;
            transform: rotate3d(8, 0.1, -5, 75deg);
            box-sizing: border-box;
            backface-visibility: visible !important;
            z-index: 5;

        }

        .shadow {
            background-color: rgba(0, 0, 0, 0.07);
            position: absolute;
            width: 250px;
            height: 30px;
            border-radius: 50%;
            top: 170px;
            left: -115px;
            z-index: -1;
        }

        .star {
            margin: 50px 0;
            position: absolute;
            display: block;
            width: 0px;
            height: 0px;
            border-right: 25px solid transparent;
            border-bottom: 17.5px solid #f9dc5c;
            border-left: 25px solid transparent;
            transform: rotate(35deg);
            top: -190px;
            left: -9px;
        }

        .star:before {
            border-bottom: 20px solid #f9dc5c;
            border-left: 7.5px solid transparent;
            border-right: 7.5px solid transparent;
            position: absolute;
            height: 0;
            width: 0;
            top: -12.5px;
            left: -17.5px;
            display: block;
            content: '';
            transform: rotate(-35deg);
        }

        .star:after {
            position: absolute;
            display: block;
            top: 0.75px;
            left: -26.25px;
            width: 0px;
            height: 0px;
            border-right: 25px solid transparent;
            border-bottom: 17.5px solid #f9dc5c;
            border-left: 25px solid transparent;
            transform: rotate(-70deg);
            content: '';
        }

        .lights {
            position: absolute;

        }

        .light1 {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
        }

        .light1 {
            background-color: #ff595e;
            top: -100px;
            left: -35px;
            transform: rotate(40deg);
            box-shadow: 1px 1px 15px #faf3dd;
        }

        .light2 {
            position: absolute;
            background-color: #ffca3a;
            top: -95px;
            left: -10px;
            box-shadow: 1px 1px 15px #faf3dd;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
            transform: rotate(40deg);
        }

        .light3 {
            position: absolute;
            background-color: #6a4c93;
            top: -105px;
            left: 15px;
            box-shadow: 1px 1px 15px #faf3dd;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
            transform: rotate(40deg);
        }

        .light4 {
            position: absolute;
            background-color: #1982c4;
            top: -118px;
            left: 35px;
            box-shadow: 1px 1px 15px #faf3dd;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
            transform: rotate(40deg);
        }

        .light5 {
            position: absolute;
            background-color: #1982c4;
            top: 12px;
            left: -55px;
            box-shadow: 1px 1px 15px #faf3dd;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
            transform: rotate(40deg);
        }

        .light6 {
            position: absolute;
            background-color: #8ac926;
            top: 15px;
            left: -25px;
            box-shadow: 1px 1px 15px #faf3dd;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
            transform: rotate(40deg);
        }

        .light7 {
            position: absolute;
            background-color: #ff595e;
            top: 10px;
            left: 2px;
            box-shadow: 1px 1px 15px #faf3dd;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
            transform: rotate(40deg);
        }

        .light8 {
            position: absolute;
            background-color: #ffca3a;
            top: -2px;
            left: 27px;
            box-shadow: 1px 1px 15px #faf3dd;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
            transform: rotate(40deg);
        }

        .light9 {
            position: absolute;
            background-color: #9e0059;
            top: -17px;
            left: 50px;
            box-shadow: 1px 1px 15px #faf3dd;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
            transform: rotate(40deg);
        }

        .light10 {
            position: absolute;
            background-color: #4361ee;
            top: -40px;
            left: 68px;
            box-shadow: 1px 1px 15px #faf3dd;
            width: 15px;
            height: 15px;
            border-radius: 10px 150px 30px 150px;
            transform: rotate(40deg);
        }



        .ribbon {
            position: absolute;
            width: 20px;
            height: 10px;
            border: 3px solid #db3a34;
            border-radius: 50%;
            transform: skew(15deg, 15deg);
            top: 116px;
            left: 35px;
        }

        .ribbon:before {
            content: "";
            position: absolute;
            width: 20px;
            height: 10px;
            border: 3px solid #db3a34;
            border-radius: 50%;
            transform: skew(-15deg, -20deg);
            left: 22px;
            top: -8px;
        }

        .gift2 {
            position: absolute;
            width: 50px;
            height: 40px;
            background-color: #08bdbd;
            top: 140px;
            left: -65px;
            box-shadow: inset -8px 0 0 rgba(0, 0, 0, 0.07);

        }

        .gift2:before {
            content: "";
            position: absolute;
            width: 60px;
            height: 15px;
            background-color: #08bdbd;
            left: -5px;
            box-shadow: inset -8px -4px 0 rgba(0, 0, 0, 0.07);

        }

        .gift2:after {
            content: "";
            background-color: #abff4f;
            width: 10px;
            height: 40px;
            position: absolute;
            left: 15px;
        }

        .gift3 {
            position: absolute;
            width: 40px;
            height: 30px;
            background-color: #7678ed;
            top: 150px;
            left: -85px;
            box-shadow: inset -8px 0 0 rgba(0, 0, 0, 0.07);

        }

        .gift3:before {
            content: "";
            position: absolute;
            width: 50px;
            height: 10px;
            background-color: #7678ed;
            left: -5px;
            box-shadow: inset -8px -4px 0 rgba(0, 0, 0, 0.07);

        }

        .gift3:after {
            content: "";
            background-color: #f7b801;
            width: 7px;
            height: 30px;
            position: absolute;
            left: 15px;
        }

        .ribbon2 {
            position: absolute;
            width: 15px;
            height: 7px;
            border: 3px solid #abff4f;
            border-radius: 50%;
            transform: skew(15deg, 15deg);
            top: 129px;
            left: -65px;
        }

        .ribbon2:before {
            content: "";
            position: absolute;
            width: 15px;
            height: 7px;
            border: 3px solid #abff4f;
            border-radius: 50%;
            transform: skew(-15deg, -20deg);
            left: 15px;
            top: -8px;
        }

        .ribbon3 {
            position: absolute;
            width: 12px;
            height: 5px;
            border: 3px solid #f7b801;
            border-radius: 50%;
            transform: skew(15deg, 15deg);
            top: 142px;
            left: -85px;
        }

        .ribbon3:before {
            content: "";
            position: absolute;
            width: 12px;
            height: 5px;
            border: 3px solid #f7b801;
            border-radius: 50%;
            transform: skew(-15deg, -20deg);
            left: 15px;
            top: -8px;
        }

        .balls {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #db3a34;
            top: 15px;
            left: -15px;
        }

        .balls:before {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #ffc857;
            top: 35px;
            left: -15px;
        }

        .balls:after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #f07167;
            top: 20px;
            left: 45px;
        }

        .ball1 {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #fae588;
            top: -90px;
            left: 20px;

        }

        .ball1:before {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #fae588;
            content: "";
            top: 170px;
            left: 50px
        }

        .light1,
        .light2,
        .light3,
        .light4,
        .light5,
        .light6,
        .light7,
        .light8,
        .light9,
        .light10 {
            -webkit-animation: flash 6s infinite;
        }

        @-webkit-keyframes flash {

            20%,
            24%,
            55% {
                box-shadow: none;
            }

            0%,
            19%,
            21%,
            23%,
            25%,
            54%,
            56%,
            100% {
                box-shadow: 0 0 5px #f5de93, 0 0 15px #f5de93, 0 0 20px #f5de93, 0 0 40px #f5de93, 0 0 60px #decea4, 0 0 10px #d6c0a5, 0 0 98px #ff0000;
            }
        }

        .content {
            font-size: 24px;
            position: absolute;
            top: 80%;
            left: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
        }

        .link {
            color: #17ACFF;
            text-decoration: underline;

        }

        .receivedgifts {
            display: grid;
            grid-template-columns: 120px 120px 120px;
            margin-left: 20px;
            margin-top: 120px;
            position: absolute;
        }

        /* .gift{
            margin-left: 10px;
        } */
        .rate {
            position: relative;
            left: 25%;
            font-weight: 900;
        }

        .sendfriend {
            background-color: #ffffff;
            border: none;
            border-radius: 10px;
            padding: 10px;
            font-size: 15px;
            font-weight: 900;
            position: absolute;
            top: 3%;
            left: 74%;
        }

        @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap");
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Dongle&family=Jua&display=swap');

        body {
            background-color: rgba(244, 223, 30, 0.56);

        }

        .coupon {
            background: white;
            width: 300px;
            height: 500px;
            border-radius: 20px;
            padding: 10px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 1px solid rgb(122, 122, 122);
        }

        .title {
            color: rgb(0, 0, 0);
            font-weight: 900;
            font-size: 30px;
            white-space: nowrap;
            margin-left: 10%;
            margin-top: 10px;
            font-family: "Poppins", sans-serif;

        }

        .present {
            color: rgb(0, 0, 0);
            font-weight: 700;
            font-size: 20px;
            margin-left: 70px;
            margin-top: 150px;
            font-family: "Jua", sans-serif;

        }

        label {
            color: rgb(0, 0, 0);
            font-weight: 800;
            margin-left: 20px;

        }

        .instagram {
            border: none;
            width: 200px;
            height: 20px;
            border-radius: 10px;
            margin-top: 100px;
            border: 1px solid black;
        }

        .submit {
            margin-left: 110px;
            margin-top: 100px;
            background-color: rgb(255, 22, 22);
            border: none;
            padding: 5px;
            width: 100px;
            font-size: 20px;
            font-family: "Jua", sans-serif;
            border-radius: 10px;
            color: white;

        }

        body {
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }

        .snow-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .snow {
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        .ad {
            position: absolute;
            top: 90%;
        }
    </style>
</head>

<body>
    <div class="ad">
        <ins class="kakao_ad_area" style="display:none;" data-ad-unit="DAN-k4qH6mBUja42MsB5" data-ad-width="320"
            data-ad-height="100"></ins>
        <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
        <div class="snow-container" id="snowContainer"></div>

    </div>

    <div class="christmas">
        <div class="tree">
            <div class="chain"></div>
            <div class="chain2"></div>
        </div>
        <div class="lights">
            <div class="light1"></div>
            <div class="light2"></div>
            <div class="light3"></div>
            <div class="light4"></div>
            <div class="light5"></div>
            <div class="light6"></div>
            <div class="light7"></div>
            <div class="light8"></div>
            <div class="light9"></div>
            <div class="light10"></div>
        </div>
        <div class="balls">
            <div class="ball1"></div>
        </div>
        <div class="star"></div>
        <div class="gift"></div>
        <div class="ribbon"></div>
        <div class="gift2"></div>
        <div class="ribbon2"></div>
        <div class="gift3"></div>
        <div class="ribbon3"></div>
        <div class="shadow"></div>

    </div>
    <div class="receivedgifts">

    </div>

    <div class="content">선물받을 <span class="link" onclick="copy()">링크</span>를 공유해보세요</div>
    <button class="sendfriend" onclick="showgivefriends()">보낸친구</button>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>

        const SURL = 'https://christmasgiftshare.site'
        const username = localStorage.getItem('un')
        const receivedgiftsdiv = document.querySelector('.receivedgifts')

        let gift

        if (!username) {
            document.querySelector('.content').style.display = 'none'
            Swal.fire("크리스마스 명언 친구들과 공유하세요!")
            const christmasQuotes = [
                "크리스마스는 단지 선물을 주고받는 날이 아니라, 사랑과 희망을 나누는 시간입니다.",
                "진정한 크리스마스의 의미는 물질이 아닌, 마음 속의 따뜻함과 나눔에 있습니다.",
                "크리스마스는 우리가 내면의 평화를 찾고, 다른 이들에게 그 평화를 나누는 날입니다.",
                "가장 소중한 선물은 물질이 아니라, 시간을 나누고 함께하는 순간들입니다.",
                "크리스마스의 진정한 기쁨은 우리가 가진 것을 나누는 데서 오는 법입니다.",
                "크리스마스는 우리에게 삶의 가장 중요한 가치, 즉 사랑과 연민을 일깨워주는 기회입니다.",
                "이 세상에서 가장 큰 기쁨은 다른 사람을 위해 살아가는 것, 크리스마스는 그 시작입니다.",
                "크리스마스는 끝이 아닌, 새로운 시작을 의미하는 시간입니다. 그것은 사랑과 희망의 씨앗을 심는 계절입니다.",
                "크리스마스는 우리가 서로를 진심으로 이해하고, 모든 갈등을 넘어서는 희망의 시간입니다.",
                "진정한 크리스마스를 맞이하기 위해선 먼저 자신을 사랑하고, 그 사랑을 세상에 퍼뜨려야 합니다.",
                "크리스마스는 우리가 불완전함을 받아들이고, 그 속에서 서로를 향한 자비를 찾는 날입니다.",
                "크리스마스는 물질적인 풍요를 넘어, 정신적이고 영적인 풍요를 추구하는 시간입니다.",
                "크리스마스는 일시적인 기쁨이 아니라, 지속적인 사랑과 연민의 마음을 만드는 계기입니다.",
                "크리스마스가 다가오면, 우리는 내면의 고요와 평화를 되새기며, 사랑의 의미를 깊이 생각하게 됩니다.",
                "크리스마스는 세상 모든 이들이 사랑을 실천할 수 있는 기회를 제공하는 시간입니다."
            ];
            for (x = 0; x < 10; x++) {

                var imgt = document.createElement('img')
                var ratespant = document.createElement('div');
                var spant = document.createElement('span');
                var namet = document.createElement('div')


                spant.className = 'gift'

                ratespant.className = 'rate'

                namet.className = 'giveusername'
                // name.innerText = element.giveusername

                imgt.src = "{{ url_for('static', filename='images/free-icon-giftbox-3349225.png') }}"
                imgt.width = 100
                imgt.height = 100
                imgt.id = 'testimg'
                imgt.className = christmasQuotes[x]
                spant.appendChild(imgt)
                imgt.addEventListener('click', (e) => {

                    window.navigator.clipboard.writeText(e.target.className).then(() => {
                        Swal.fire({
                            title: e.target.className,
                            text: "복사되었습니다",
                            icon: "success"
                        });
                    })
                })

                spant.appendChild(ratespant)
                spant.appendChild(namet)

                receivedgiftsdiv.appendChild(spant)
            }
        }

        function showgivefriends() {
            fetch(`${SURL}/giveuser`, {
                method: "POST",

                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    username: username,
                }),
            }).then((response) => response.json())
                .then((data) => {
                    var user = []
                    console.log(data)
                    data[0].forEach(element => {
                        user.push(element['giveusername'])
                    });
                    Swal.fire({
                        icon: 'info',
                        title: '보낸 사람 목록',
                        text: user,
                    })
                });
        }
        function receive() {

            console.log(gift)
            document.querySelector('.coupon').style.display = 'none'

            fetch(`${SURL}/saveopen`, {
                method: "POST",

                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    username: username,
                    giftindex: gift,
                    Id: document.querySelector('.instagram').value

                }),
            }).then((response) => {
                localStorage.setItem('useriid', document.querySelector('.instagram').value)
                location.reload()
                document.querySelector('.instagram').value = localStorage.getItem("useriid")

            })
        }
        function copy() {
            window.navigator.clipboard.writeText(`${SURL}/givegifts/${username}`).then(() => {
                // 복사가 완료되면 호출된다.
                alert("링크 복사완료");
            })
        }



        fetch(`${SURL}/checkreceivedgifts/`, {
            method: "POST",
            async: false,
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                username: username,

            }),
        }).then((response) => response.json())
            .then((data) => {
                console.log(data)
                if (data.length > 0) {
                    document.querySelector('.christmas').style.display = 'none'
                }
                data.forEach(element => {
                    var img = document.createElement('img')
                    var ratespan = document.createElement('div');
                    var span = document.createElement('span');
                    var name = document.createElement('div')


                    span.className = 'gift'
                    span.id = element.giftrate + '.' + element.giveusername

                    ratespan.className = 'rate'
                    ratespan.innerText = element.giftrate + '등급'

                    name.className = 'giveusername'
                    // name.innerText = element.giveusername

                    img.src = "{{ url_for('static', filename='images/free-icon-giftbox-3349225.png') }}"
                    img.width = 100
                    img.height = 100
                    span.appendChild(img)

                    span.appendChild(ratespan)
                    span.appendChild(name)

                    receivedgiftsdiv.appendChild(span)

                });
                let imgs = document.querySelectorAll('img')
                console.log(imgs)
                for (const img of imgs) {
                    if (img.id == 'testimg') {
                    }
                    else {
                        img.addEventListener('click', giftclick)
                    }

                }
                function giftclick(e) {
                    console.log("hello")
                    e.preventDefault();
                    var rate = e.target.parentElement.id
                    fetch(`${SURL}/openreceivedgifts/`, {
                        method: "POST",
                        async: false,
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            username: username,
                            giftindex: rate,

                        }),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            console.log(data)
                            // document.querySelector('.coupon').style.display = 'block'
                            gift = data.gift
                            // document.querySelector('.present').innerText = gift
                            if (gift == "꽝") {
                                Swal.fire("꽝 아쉽네요ㅠ");
                            }
                            else {
                                const { value: ipAddress } = Swal.fire({
                                    title: "축하합니다!" + ' ' + gift + '에 당첨 되셨습니다',
                                    input: "text",
                                    inputLabel: "전화번호 또는 인스타아이디를 입력하세요",
                                    inputValue,
                                    showCancelButton: true,
                                    inputValidator: (value) => {
                                        if (!value) {
                                            return "You need to write something!";
                                        }
                                    }
                                });
                                if (ipAddress) {
                                    Swal.fire('최대 몇시간이 소요될 수 있습니다!');
                                    receive()
                                    location.reload()
                                }
                            }

                        });

                }
            });






    </script>
</body>

</html>
